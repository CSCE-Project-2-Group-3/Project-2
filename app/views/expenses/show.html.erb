<h1>Expense</h1>

<dl>
  <dt>Title</dt>
  <dd><%= @expense.title %></dd>

  <dt>Amount</dt>
  <dd><%= number_to_currency(@expense.amount) %></dd>

  <dt>Spent on</dt>
  <dd><%= @expense.spent_on %></dd>

  <dt>Category</dt>
  <dd><%= @expense.category&.name || "â€”" %></dd>

  <dt>Split with</dt>
  <dd><%= participant_summary(@expense) %></dd>

  <% if @expense.notes.present? %>
    <dt>Notes</dt>
    <dd><%= simple_format(@expense.notes) %></dd>
  <% end %>
</dl>

<%# Send Message button under the expense %>
<% if user_signed_in? && current_user.id != @expense.user_id %>
  <div class="expense-send-message">
    <%= button_to "Send Message", conversations_path(recipient_id: @expense.user_id, expense_author_id: @expense.user_id), method: :post, class: "button" %>
  </div>
<% elsif user_signed_in? %>
  <div class="expense-send-message">
    <em>This is your expense.</em>
  </div>
<% else %>
  <div>
    <%= link_to "Log in to message the author", new_user_session_path %>
  </div>
<% end %>

<hr>

<div style="display:flex; gap:.75rem; flex-wrap:wrap;">
  <%= link_to "Back to Expenses", expenses_path %>
  <%= link_to "Edit", edit_expense_path(@expense), class: "button" %>

  <!-- Delete button: posts a DELETE to /expenses/:id -->
  <%= button_to "Delete this expense",
                expense_path(@expense),
                method: :delete,
                data: { turbo_confirm: "Are you sure you want to delete this expense?" } %>
</div>

<hr>

<div class="comments-section">
  <h2>Comments</h2>
  <div class="comments-thread">
    <% @expense.comments.each do |comment| %>
      <div class="comment"><strong><%= comment.user.email %></strong>: <%= comment.body %></div>
    <% end %>
  </div>

  <%= form_with(model: [@expense, Comment.new], local: true) do |f| %>
    <div style="margin-top:0.75rem;">
      <%= f.label :body, 'Comment' %><br>
      <%= f.text_area :body, rows: 3, required: true %>
    </div>
    <%= f.submit 'Post Comment' %>
  <% end %>
</div>

<h1>Review receipt</h1>

<% if @receipt.file.attached? %>
  <div style="max-width:600px;">
    <%= image_tag url_for(@receipt.file), style: "max-width:100%; height:auto;" %>
  </div>
<% end %>

<%= form_with url: confirm_receipt_path(@receipt), local: true do |f| %>
  <% if @candidates.present? %>
    <h2>Detected amounts</h2>
    <% @candidates.each_with_index do |c, i| %>
      <div style="margin-bottom:8px;">
        <%= radio_button_tag :amount, (c["normalized"] || c["raw"]), i == 0 %>
        <%= label_tag nil, "#{c["raw"]} â€” #{c["context_line"] || ''} (score: #{c["score"] || 'n/a'})" %>
      </div>
    <% end %>
  <% else %>
    <p>No amounts detected automatically.</p>
  <% end %>

  <div>
    <label>Manual amount (if wrong)</label><br/>
    <%= text_field_tag :manual_amount %>
  </div>

  <div>
    <label>Date</label><br/>
    <%= date_field_tag :happened_on, (@candidates.first && @candidates.first["date"]) || Date.today %>
  </div>

  <div>
    <label>Merchant</label><br/>
    <%= text_field_tag :merchant, (@candidates.first && @candidates.first["merchant"]) %>
  </div>

  <div>
    <label>Category</label><br/>
    <%= select_tag :category_id, options_for_select(Category.all.pluck(:name, :id), (@candidates.first && @candidates.first["category"])) %>
  </div>

  <div>
    <label>Notes</label><br/>
    <%= text_area_tag :notes %>
  </div>

  <div>
    <%= submit_tag "Create Expense" %>
  </div>
<% end %>

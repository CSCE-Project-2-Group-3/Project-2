<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Project2</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.13.2/application.js' type='text/javascript'></script>
    <link href='./assets/0.13.2/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="icon" type="image/png" href="./assets/0.13.2/favicon_green.png" />
  </head>

  <body>
    <div id="loading">
      <img src="./assets/0.13.2/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
<<<<<<< HEAD
      <div class="timestamp">Generated <abbr class="timeago" title="2025-11-01T16:53:08-05:00">2025-11-01T16:53:08-05:00</abbr></div>
=======
      <div class="timestamp">Generated <abbr class="timeago" title="2025-10-30T22:45:18-05:00">2025-10-30T22:45:18-05:00</abbr></div>
>>>>>>> main
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="green">
  99.23%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
<<<<<<< HEAD
         13.54
=======
         13.99
>>>>>>> main
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
<<<<<<< HEAD
    <b>27</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>448</b> relevant lines,
    <span class="green"><b>448</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
=======
    <b>24</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>391</b> relevant lines,
    <span class="green"><b>388</b> lines covered</span> and
    <span class="red"><b>3</b> lines missed. </span>
>>>>>>> main
    (<span class="green">
  99.23%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#f0924342dced7d46a8079d66cbfa8ba02fe85fa7" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#72c1773f08b54f857d94c0bf4248b899c28a760b" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">12</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.67</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#15a367fb107d4d8efc5a4eba143d3e85bd56f148" class="src_link" title="app/controllers/categories_controller.rb">app/controllers/categories_controller.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#021cc4f3b4c211bc7e60b7f5a244cd8566b374bd" class="src_link" title="app/controllers/categories_controller.rb">app/controllers/categories_controller.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.27</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#49162e333cf86f09b23270e0385f50903261baef" class="src_link" title="app/controllers/comments_controller.rb">app/controllers/comments_controller.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#088e64f46df03e6dcfc4a85a5f106adaa2acc9cb" class="src_link" title="app/controllers/comments_controller.rb">app/controllers/comments_controller.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">13</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.31</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#4c688ecfe618e5ffc9b362cb9499ed58cb5c3677" class="src_link" title="app/controllers/conversations_controller.rb">app/controllers/conversations_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">25</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2.08</td>
=======
            <td class="strong t-file__name"><a href="#dad12a40fee2a7e126015de0912b46c7ef90bf96" class="src_link" title="app/controllers/conversations_controller.rb">app/controllers/conversations_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.10 %</td>
            <td class="cell--number">55</td>
            <td class="cell--number">29</td>
            <td class="cell--number">27</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1.83</td>
>>>>>>> main
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#29f05f8cc939d2c004c4ba659ec6fecc8113f8fb" class="src_link" title="app/controllers/expenses_controller.rb">app/controllers/expenses_controller.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#f0e20683d3dc6b59005a6651b804b40e081bdccc" class="src_link" title="app/controllers/expenses_controller.rb">app/controllers/expenses_controller.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">97</td>
            <td class="cell--number">48</td>
            <td class="cell--number">48</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4.19</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#9f3a1826e94d6a867daf5f1abeadf58c7d8f1a76" class="src_link" title="app/controllers/groups_controller.rb">app/controllers/groups_controller.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#6acbb6263420eccabd22b745fa125b4cc1758ab7" class="src_link" title="app/controllers/groups_controller.rb">app/controllers/groups_controller.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">48</td>
            <td class="cell--number">26</td>
            <td class="cell--number">26</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.35</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#400f39e1cc2d271427d1060f83c3fb1661d97a19" class="src_link" title="app/controllers/messages_controller.rb">app/controllers/messages_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">35</td>
            <td class="cell--number">17</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.47</td>
=======
            <td class="strong t-file__name"><a href="#f1e52738ce07a6caa974a337b4c63ce4cfff8ad6" class="src_link" title="app/controllers/messages_controller.rb">app/controllers/messages_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.24 %</td>
            <td class="cell--number">38</td>
            <td class="cell--number">21</td>
            <td class="cell--number">20</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1.33</td>
>>>>>>> main
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#993fc1a41700027a78c0f03967188444bc2d98e3" class="src_link" title="app/controllers/pages_controller.rb">app/controllers/pages_controller.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#2e7c9ae90d34b460113d61374780ad5cb5d8bf7f" class="src_link" title="app/controllers/pages_controller.rb">app/controllers/pages_controller.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">116</td>
            <td class="cell--number">39</td>
            <td class="cell--number">39</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8.82</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#dfebe98e1e225e6917b293a0bf61033dda5034ce" class="src_link" title="app/controllers/widget_summaries_controller.rb">app/controllers/widget_summaries_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">26</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#392288d24cfede95fb97517a5520bbc854130a99" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#d8db9d419c96ec9a8d22a0db7d65cdac80777d3e" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#aa28821daad526419e7aebaf3655987110cf6e57" class="src_link" title="app/helpers/conversations_helper.rb">app/helpers/conversations_helper.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#57235473b7cd6875fd52012c117529bdac86c511" class="src_link" title="app/helpers/conversations_helper.rb">app/helpers/conversations_helper.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#9aa1748971c98ec8c5ed99b0eff92d87561ec243" class="src_link" title="app/helpers/expenses_helper.rb">app/helpers/expenses_helper.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#af573ed98042a5cbe05590cdc80307ec02d4d453" class="src_link" title="app/helpers/expenses_helper.rb">app/helpers/expenses_helper.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">14</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.07</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#191a6fce8256beda2bfa38f3c4745aa43ed61f83" class="src_link" title="app/helpers/messages_helper.rb">app/helpers/messages_helper.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#7d0d770c90996975449f916871cf1d0e10e05f84" class="src_link" title="app/helpers/messages_helper.rb">app/helpers/messages_helper.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#a9575c90fb470617c2a07248cd8da1033aad190c" class="src_link" title="app/helpers/pages_helper.rb">app/helpers/pages_helper.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#41763dbe296e1055a87d0402d12e095103b8f48d" class="src_link" title="app/helpers/pages_helper.rb">app/helpers/pages_helper.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#a275dc698299be5650b00b09b2e8521caa12fe54" class="src_link" title="app/helpers/widget_summaries_helper.rb">app/helpers/widget_summaries_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#996b2c75713f0647f71cb05e1fb23645a9b75eed" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#924b86297b25c3b5a27201de54015e138e96b72a" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#41d047064878ec398a0c071278ee6a594d08b771" class="src_link" title="app/models/category.rb">app/models/category.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#dd2060ae2bdbd97717cd543ff691f670fa19cf91" class="src_link" title="app/models/category.rb">app/models/category.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">5</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">26.50</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#45b0d42d380a2e1843b7d460b9e2c932953da6e6" class="src_link" title="app/models/comment.rb">app/models/comment.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#bfed032cef9bb3c6277409d1c038d5e325099558" class="src_link" title="app/models/comment.rb">app/models/comment.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#fd21aed388ee081529df17dd6538359fcfc3644d" class="src_link" title="app/models/conversation.rb">app/models/conversation.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#8d3189a45901a4e931d8fbb7433d725a4a3d97a9" class="src_link" title="app/models/conversation.rb">app/models/conversation.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">50</td>
            <td class="cell--number">29</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0</td>
<<<<<<< HEAD
            <td class="cell--number">3.55</td>
=======
            <td class="cell--number">3.40</td>
>>>>>>> main
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#07a4f71dfd2a8211ef421c2d8313059c5f8fd305" class="src_link" title="app/models/expense.rb">app/models/expense.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#5b89a928b061964091ebe71b5be0d8ffb20bcc33" class="src_link" title="app/models/expense.rb">app/models/expense.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">107</td>
            <td class="cell--number">65</td>
            <td class="cell--number">65</td>
            <td class="cell--number">0</td>
<<<<<<< HEAD
            <td class="cell--number">72.43</td>
=======
            <td class="cell--number">63.88</td>
>>>>>>> main
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#fbb6f6d593e4932b3526b0d6c7accc8d46778e5c" class="src_link" title="app/models/group.rb">app/models/group.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#2f34ae36b28c09afa7db6504a2a7610a2a0f9d0f" class="src_link" title="app/models/group.rb">app/models/group.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">23</td>
            <td class="cell--number">13</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.85</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#1e01f0d38b3c300df0e1e7d7cb78a8e7296e1f6e" class="src_link" title="app/models/group_membership.rb">app/models/group_membership.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#1d5c5c9153350c358036fbcafa3ba2777919ec69" class="src_link" title="app/models/group_membership.rb">app/models/group_membership.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#2624ceffe4a43ff8d315139143b8af6b089de889" class="src_link" title="app/models/message.rb">app/models/message.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#df9ead13c7d1c32f655164ce5d6af93a8fee6346" class="src_link" title="app/models/message.rb">app/models/message.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">11</td>
            <td class="cell--number">7</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.14</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#1c434006e4819535eca7e131a9ef9da95a44f538" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#f7af3d0d0ba44bcc9628c1c058ad55f41380e8e8" class="src_link" title="app/models/message_expense.rb">app/models/message_expense.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#3e0456f6c40cb8fbd9b72480746f4a4e4098a914" class="src_link" title="app/services/dashboard_ai_analyzer_service.rb">app/services/dashboard_ai_analyzer_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">110</td>
            <td class="cell--number">34</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.85</td>
=======
            <td class="strong t-file__name"><a href="#eb48e1ae0e40e0a2ceedf36cb40e4d9b3e058226" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">37</td>
            <td class="cell--number">13</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4.00</td>
>>>>>>> main
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#75a095242756d69fd460c0c249dbfd0fdaf1aee8" class="src_link" title="app/services/dashboard_data_service.rb">app/services/dashboard_data_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">85</td>
            <td class="cell--number">30</td>
            <td class="cell--number">30</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.90</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2942d803fdf142d462860d22b2c8adb1c385a76b" class="src_link" title="app/services/imports/expenses_import.rb">app/services/imports/expenses_import.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#0a93c323d0a5da52e6b70bff5adb8a2622325228" class="src_link" title="app/services/imports/expenses_import.rb">app/services/imports/expenses_import.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">65</td>
            <td class="cell--number">33</td>
            <td class="cell--number">33</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4.91</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent">
      <span class="green">
  98.46%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
<<<<<<< HEAD
         3.62
=======
         3.91
>>>>>>> main
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Controllers"></a>

  <div>
    <b>9</b> files in total.
  </div>

  <div class="t-line-summary">
<<<<<<< HEAD
    <b>196</b> relevant lines,
    <span class="green"><b>196</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
=======
    <b>195</b> relevant lines,
    <span class="green"><b>192</b> lines covered</span> and
    <span class="red"><b>3</b> lines missed. </span>
>>>>>>> main
    (<span class="green">
  98.46%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#f0924342dced7d46a8079d66cbfa8ba02fe85fa7" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#72c1773f08b54f857d94c0bf4248b899c28a760b" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">12</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.67</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#15a367fb107d4d8efc5a4eba143d3e85bd56f148" class="src_link" title="app/controllers/categories_controller.rb">app/controllers/categories_controller.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#021cc4f3b4c211bc7e60b7f5a244cd8566b374bd" class="src_link" title="app/controllers/categories_controller.rb">app/controllers/categories_controller.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">20</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.27</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#49162e333cf86f09b23270e0385f50903261baef" class="src_link" title="app/controllers/comments_controller.rb">app/controllers/comments_controller.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#088e64f46df03e6dcfc4a85a5f106adaa2acc9cb" class="src_link" title="app/controllers/comments_controller.rb">app/controllers/comments_controller.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">13</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.31</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#4c688ecfe618e5ffc9b362cb9499ed58cb5c3677" class="src_link" title="app/controllers/conversations_controller.rb">app/controllers/conversations_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">25</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2.08</td>
=======
            <td class="strong t-file__name"><a href="#dad12a40fee2a7e126015de0912b46c7ef90bf96" class="src_link" title="app/controllers/conversations_controller.rb">app/controllers/conversations_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.10 %</td>
            <td class="cell--number">55</td>
            <td class="cell--number">29</td>
            <td class="cell--number">27</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1.83</td>
>>>>>>> main
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#29f05f8cc939d2c004c4ba659ec6fecc8113f8fb" class="src_link" title="app/controllers/expenses_controller.rb">app/controllers/expenses_controller.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#f0e20683d3dc6b59005a6651b804b40e081bdccc" class="src_link" title="app/controllers/expenses_controller.rb">app/controllers/expenses_controller.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">97</td>
            <td class="cell--number">48</td>
            <td class="cell--number">48</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4.19</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#9f3a1826e94d6a867daf5f1abeadf58c7d8f1a76" class="src_link" title="app/controllers/groups_controller.rb">app/controllers/groups_controller.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#6acbb6263420eccabd22b745fa125b4cc1758ab7" class="src_link" title="app/controllers/groups_controller.rb">app/controllers/groups_controller.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">48</td>
            <td class="cell--number">26</td>
            <td class="cell--number">26</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.35</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#400f39e1cc2d271427d1060f83c3fb1661d97a19" class="src_link" title="app/controllers/messages_controller.rb">app/controllers/messages_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">35</td>
            <td class="cell--number">17</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.47</td>
=======
            <td class="strong t-file__name"><a href="#f1e52738ce07a6caa974a337b4c63ce4cfff8ad6" class="src_link" title="app/controllers/messages_controller.rb">app/controllers/messages_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.24 %</td>
            <td class="cell--number">38</td>
            <td class="cell--number">21</td>
            <td class="cell--number">20</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1.33</td>
>>>>>>> main
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#993fc1a41700027a78c0f03967188444bc2d98e3" class="src_link" title="app/controllers/pages_controller.rb">app/controllers/pages_controller.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#2e7c9ae90d34b460113d61374780ad5cb5d8bf7f" class="src_link" title="app/controllers/pages_controller.rb">app/controllers/pages_controller.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">116</td>
            <td class="cell--number">39</td>
            <td class="cell--number">39</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8.82</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#dfebe98e1e225e6917b293a0bf61033dda5034ce" class="src_link" title="app/controllers/widget_summaries_controller.rb">app/controllers/widget_summaries_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">26</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Channels">
  <h2>
    <span class="group_name">Channels</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Channels"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
<<<<<<< HEAD
         36.07
=======
         31.03
>>>>>>> main
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Models"></a>

  <div>
    <b>10</b> files in total.
  </div>

  <div class="t-line-summary">
<<<<<<< HEAD
    <b>136</b> relevant lines,
    <span class="green"><b>136</b> lines covered</span> and
=======
    <b>145</b> relevant lines,
    <span class="green"><b>145</b> lines covered</span> and
>>>>>>> main
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#996b2c75713f0647f71cb05e1fb23645a9b75eed" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#924b86297b25c3b5a27201de54015e138e96b72a" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#41d047064878ec398a0c071278ee6a594d08b771" class="src_link" title="app/models/category.rb">app/models/category.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#dd2060ae2bdbd97717cd543ff691f670fa19cf91" class="src_link" title="app/models/category.rb">app/models/category.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">5</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">26.50</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#45b0d42d380a2e1843b7d460b9e2c932953da6e6" class="src_link" title="app/models/comment.rb">app/models/comment.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#bfed032cef9bb3c6277409d1c038d5e325099558" class="src_link" title="app/models/comment.rb">app/models/comment.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#fd21aed388ee081529df17dd6538359fcfc3644d" class="src_link" title="app/models/conversation.rb">app/models/conversation.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#8d3189a45901a4e931d8fbb7433d725a4a3d97a9" class="src_link" title="app/models/conversation.rb">app/models/conversation.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">50</td>
            <td class="cell--number">29</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0</td>
<<<<<<< HEAD
            <td class="cell--number">3.55</td>
=======
            <td class="cell--number">3.40</td>
>>>>>>> main
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#07a4f71dfd2a8211ef421c2d8313059c5f8fd305" class="src_link" title="app/models/expense.rb">app/models/expense.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#5b89a928b061964091ebe71b5be0d8ffb20bcc33" class="src_link" title="app/models/expense.rb">app/models/expense.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">107</td>
            <td class="cell--number">65</td>
            <td class="cell--number">65</td>
            <td class="cell--number">0</td>
<<<<<<< HEAD
            <td class="cell--number">72.43</td>
=======
            <td class="cell--number">63.88</td>
>>>>>>> main
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#fbb6f6d593e4932b3526b0d6c7accc8d46778e5c" class="src_link" title="app/models/group.rb">app/models/group.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#2f34ae36b28c09afa7db6504a2a7610a2a0f9d0f" class="src_link" title="app/models/group.rb">app/models/group.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">23</td>
            <td class="cell--number">13</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.85</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#1e01f0d38b3c300df0e1e7d7cb78a8e7296e1f6e" class="src_link" title="app/models/group_membership.rb">app/models/group_membership.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#1d5c5c9153350c358036fbcafa3ba2777919ec69" class="src_link" title="app/models/group_membership.rb">app/models/group_membership.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#2624ceffe4a43ff8d315139143b8af6b089de889" class="src_link" title="app/models/message.rb">app/models/message.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#df9ead13c7d1c32f655164ce5d6af93a8fee6346" class="src_link" title="app/models/message.rb">app/models/message.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">11</td>
            <td class="cell--number">7</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.14</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#1c434006e4819535eca7e131a9ef9da95a44f538" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#f7af3d0d0ba44bcc9628c1c058ad55f41380e8e8" class="src_link" title="app/models/message_expense.rb">app/models/message_expense.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#eb48e1ae0e40e0a2ceedf36cb40e4d9b3e058226" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">37</td>
            <td class="cell--number">13</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Mailers"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         2.53
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Helpers"></a>

  <div>
    <b>6</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>19</b> relevant lines,
    <span class="green"><b>19</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#392288d24cfede95fb97517a5520bbc854130a99" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#d8db9d419c96ec9a8d22a0db7d65cdac80777d3e" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#aa28821daad526419e7aebaf3655987110cf6e57" class="src_link" title="app/helpers/conversations_helper.rb">app/helpers/conversations_helper.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#57235473b7cd6875fd52012c117529bdac86c511" class="src_link" title="app/helpers/conversations_helper.rb">app/helpers/conversations_helper.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#9aa1748971c98ec8c5ed99b0eff92d87561ec243" class="src_link" title="app/helpers/expenses_helper.rb">app/helpers/expenses_helper.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#af573ed98042a5cbe05590cdc80307ec02d4d453" class="src_link" title="app/helpers/expenses_helper.rb">app/helpers/expenses_helper.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">14</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.07</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#191a6fce8256beda2bfa38f3c4745aa43ed61f83" class="src_link" title="app/helpers/messages_helper.rb">app/helpers/messages_helper.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#7d0d770c90996975449f916871cf1d0e10e05f84" class="src_link" title="app/helpers/messages_helper.rb">app/helpers/messages_helper.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#a9575c90fb470617c2a07248cd8da1033aad190c" class="src_link" title="app/helpers/pages_helper.rb">app/helpers/pages_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a275dc698299be5650b00b09b2e8521caa12fe54" class="src_link" title="app/helpers/widget_summaries_helper.rb">app/helpers/widget_summaries_helper.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#41763dbe296e1055a87d0402d12e095103b8f48d" class="src_link" title="app/helpers/pages_helper.rb">app/helpers/pages_helper.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Jobs">
  <h2>
    <span class="group_name">Jobs</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Jobs"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Libraries"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Ungrouped">
  <h2>
    <span class="group_name">Ungrouped</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         4.14
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Ungrouped"></a>

  <div>
    <b>3</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>97</b> relevant lines,
    <span class="green"><b>97</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
<<<<<<< HEAD
            <td class="strong t-file__name"><a href="#3e0456f6c40cb8fbd9b72480746f4a4e4098a914" class="src_link" title="app/services/dashboard_ai_analyzer_service.rb">app/services/dashboard_ai_analyzer_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">110</td>
            <td class="cell--number">34</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.85</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#75a095242756d69fd460c0c249dbfd0fdaf1aee8" class="src_link" title="app/services/dashboard_data_service.rb">app/services/dashboard_data_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">85</td>
            <td class="cell--number">30</td>
            <td class="cell--number">30</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.90</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2942d803fdf142d462860d22b2c8adb1c385a76b" class="src_link" title="app/services/imports/expenses_import.rb">app/services/imports/expenses_import.rb</a></td>
=======
            <td class="strong t-file__name"><a href="#0a93c323d0a5da52e6b70bff5adb8a2622325228" class="src_link" title="app/services/imports/expenses_import.rb">app/services/imports/expenses_import.rb</a></td>
>>>>>>> main
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">65</td>
            <td class="cell--number">33</td>
            <td class="cell--number">33</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4.91</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.13.2<br/>
        using RSpec
      </div>

      <div class="source_files">
      
<<<<<<< HEAD
        <div class="source_table" id="f0924342dced7d46a8079d66cbfa8ba02fe85fa7">
=======
        <div class="source_table" id="72c1773f08b54f857d94c0bf4248b899c28a760b">
>>>>>>> main
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>6</b> relevant lines.
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">  # Redirect user to Expense dashboard after login</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  allow_browser versions: :modern</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def after_sign_in_path_for(resource)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="5">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    expenses_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby">  # Optional: redirect to login after logout</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def after_sign_out_path_for(resource_or_scope)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="10">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    new_user_session_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="15a367fb107d4d8efc5a4eba143d3e85bd56f148">
=======
        <div class="source_table" id="021cc4f3b4c211bc7e60b7f5a244cd8566b374bd">
>>>>>>> main
  <div class="header">
    <h3>app/controllers/categories_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>11</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class CategoriesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    @category = Category.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="7">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    @category = Category.new(category_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="8">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    if @category.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      redirect_to new_expense_path, notice: &quot;Category created successfully.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      render :new, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def category_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="18">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    params.require(:category).permit(:name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="49162e333cf86f09b23270e0385f50903261baef">
=======
        <div class="source_table" id="088e64f46df03e6dcfc4a85a5f106adaa2acc9cb">
>>>>>>> main
  <div class="header">
    <h3>app/controllers/comments_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>13</b> relevant lines.
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class CommentsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :authenticate_user!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_expense</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="6">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    comment = @expense.comments.build(comment_params.merge(user: current_user))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="8">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    if comment.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      redirect_back fallback_location: expense_path(@expense), notice: &quot;Comment posted successfully&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      redirect_back fallback_location: expense_path(@expense), alert: comment.errors.full_messages.to_sentence</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_expense</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="18">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    @expense = Expense.find(params[:expense_id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def comment_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="22">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    params.require(:comment).permit(:body)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="4c688ecfe618e5ffc9b362cb9499ed58cb5c3677">
=======
        <div class="source_table" id="dad12a40fee2a7e126015de0912b46c7ef90bf96">
>>>>>>> main
  <div class="header">
    <h3>app/controllers/conversations_controller.rb</h3>
    <h4>
      <span class="green">
  93.1%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>29</b> relevant lines.
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class ConversationsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :authenticate_user!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby">    # shows conversations + messageable users grouped by shared groups</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    @conversations = Conversation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby">      .where(&quot;user_a_id = :id OR user_b_id = :id&quot;, id: current_user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby">      .includes(:messages)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby">      .order(updated_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    @groups = current_user.groups.includes(:users)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    @messageable_by_group = @groups.each_with_object({}) do |group, hash|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            

            <code class="ruby">      members = group.users.where.not(id: current_user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            

            <code class="ruby">      hash[group] = members</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="19">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    @conversation = Conversation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">      .where(&quot;user_a_id = :id OR user_b_id = :id&quot;, id: current_user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">      .find_by(id: params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="23">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    unless @conversation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      redirect_to conversations_path, alert: &quot;You are not authorized to view that conversation.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    @messages = @conversation.messages.recent.includes(:user, :quoted_expenses)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    @message = Message.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    @other_user = @conversation.other_user(current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby">    # Only show expenses from shared groups, not private expenses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    shared_group_ids = current_user.groups.pluck(:id) &amp; @other_user.groups.pluck(:id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    @expenses = @other_user.expenses</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby">                          .where(group_id: shared_group_ids)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby">                          .order(spent_on: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby">                          .limit(20)  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="39">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    recipient_id = params[:recipient_id] || params[:user_id] || params[:expense_author_id]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="40">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    recipient = User.find_by(id: recipient_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="42">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    unless recipient</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="43">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      redirect_back fallback_location: conversations_path, alert: &quot;Recipient not found.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="44">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="47">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    if recipient.id == current_user.id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      redirect_back fallback_location: conversations_path, notice: &quot;You cannot start a conversation with yourself.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="52">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    @conversation = Conversation.find_or_create_between(current_user, recipient)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="53">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    redirect_to conversation_path(@conversation)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="29f05f8cc939d2c004c4ba659ec6fecc8113f8fb">
=======
        <div class="source_table" id="f0e20683d3dc6b59005a6651b804b40e081bdccc">
>>>>>>> main
  <div class="header">
    <h3>app/controllers/expenses_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>48</b> relevant lines.
      <span class="green"><b>48</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class ExpensesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_expense, only: [ :show, :edit, :update, :destroy ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby">  # CHANGE THIS: set_group is only needed for NEW group expenses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :set_group, only: [ :new, :create ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="8">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    @expenses = Expense.for_user(current_user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby">                       .includes(:category, :user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">                       .order(spent_on: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">                       .page(params[:page]).per(20)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="12">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    @total = @expenses.sum(:amount)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="16">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    @expense = @group&amp;.expenses&amp;.build || Expense.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="20">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    @expense = @group ? @group.expenses.build(expense_params) : Expense.new(expense_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="21">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    @expense.user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="23">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    if @expense.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="24">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      flash[:notice] = &quot;Expense created!&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="25">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      redirect_to @group ? group_path(@group) : expenses_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      render :new, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">    # This line now clearly sets the @group for the form</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="33">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    @group = @expense.group</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="37">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    if @expense.update(expense_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="38">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      redirect_to expenses_path, notice: &quot;Expense updated successfully.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby">      # We need to set @group again in case of re-render</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @group = @expense.group</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      render :edit, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="47">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    @expense.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="48">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    redirect_to expenses_path, notice: &quot;Expense deleted.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            

            <code class="ruby">  # --- Bulk upload ---</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def bulk_upload</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="53">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    return redirect_to(expenses_path, alert: &quot;Please select a CSV or Excel file.&quot;) if params[:file].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="55">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    result = Imports::ExpensesImport.call(file: params[:file], user: current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    redirect_to expenses_path, notice: &quot;Imported #{result.created} rows. Skipped #{result.skipped}.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            

            <code class="ruby">  rescue Imports::ExpensesImport::ImportError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="58">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    redirect_to expenses_path, alert: e.message</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def download_template</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="62">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    template = &lt;&lt;~CSV</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            

            <code class="ruby">      title,amount,spent_on,category,notes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby">      Lunch,12.5,2025-10-18,Food,Team lunch</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            

            <code class="ruby">    CSV</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="67">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    send_data template, filename: &quot;expenses_template.csv&quot;, type: &quot;text/csv&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="72">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_expense</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="73">
            
              <span class="hits">14</span>
            

            

            <code class="ruby">    @expense = Expense.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def expense_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="77">
            
              <span class="hits">13</span>
            

            

            <code class="ruby">    permitted = params.require(:expense).permit(:title, :notes, :amount, :spent_on, :category_id, participant_ids: [])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="78">
            
              <span class="hits">13</span>
            

            

            <code class="ruby">    permitted[:participant_ids] = sanitize_participant_ids(permitted[:participant_ids])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="79">
            
              <span class="hits">13</span>
            

            

            <code class="ruby">    permitted</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def set_group</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            

            <code class="ruby">    # This is now ONLY for new/create, so it&#39;s much simpler</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="84">
            
              <span class="hits">12</span>
            

            

            <code class="ruby">    @group = Group.find_by(id: params[:group_id]) if params[:group_id]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="87">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def sanitize_participant_ids(raw_ids)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="88">
            
              <span class="hits">13</span>
            

            

            <code class="ruby">    Array(raw_ids).flatten.filter_map do |value|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="89">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      str = value.to_s.strip</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="90">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      next if str.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="92">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      Integer(str, 10)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            

            <code class="ruby">    rescue ArgumentError</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="94">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            

            <code class="ruby">    end.uniq</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="9f3a1826e94d6a867daf5f1abeadf58c7d8f1a76">
=======
        <div class="source_table" id="6acbb6263420eccabd22b745fa125b4cc1758ab7">
>>>>>>> main
  <div class="header">
    <h3>app/controllers/groups_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>26</b> relevant lines.
      <span class="green"><b>26</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class GroupsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    before_action :authenticate_user!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    @groups = current_user.groups</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    @group = Group.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="13">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    @group = Group.new(group_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="14">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    if @group.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @group.users &lt;&lt; current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      redirect_to groups_path, notice: &quot;Group created successfully.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      flash.now[:alert] = @group.errors.full_messages.to_sentence</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      render :new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def join</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="24">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    @group = Group.find_by(join_code: params[:join_code]&amp;.strip&amp;.upcase)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="25">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    if @group</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="26">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      if @group.users.include?(current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        redirect_to groups_path, alert: &quot;You are already in this group.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        @group.users &lt;&lt; current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        redirect_to groups_path, notice: &quot;Joined #{@group.name} successfully.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      redirect_to groups_path, alert: &quot;Invalid join code.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="38">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    @group = current_user.groups.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby">    # Placeholder for when Expense is ready:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby">    # @expenses = @group.expenses</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def group_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="46">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    params.require(:group).permit(:name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="400f39e1cc2d271427d1060f83c3fb1661d97a19">
=======
        <div class="source_table" id="f1e52738ce07a6caa974a337b4c63ce4cfff8ad6">
>>>>>>> main
  <div class="header">
    <h3>app/controllers/messages_controller.rb</h3>
    <h4>
      <span class="green">
  95.24%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>21</b> relevant lines.
      <span class="green"><b>20</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class MessagesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :authenticate_user!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="5">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    @conversation = Conversation.where(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">      &quot;user_a_id = :id OR user_b_id = :id&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby">      id: current_user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby">    ).find_by(id: params[:conversation_id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="10">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    unless @conversation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      redirect_to conversations_path, alert: &quot;Not authorized.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="15">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    @message = @conversation.messages.build(message_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="16">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    @message.user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="18">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    if @message.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      if params[:message][:quoted_expense_ids].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            

            <code class="ruby">        @message.quoted_expenses = Expense.where(id: params[:message][:quoted_expense_ids])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @conversation.touch</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      redirect_to conversation_path(@conversation, anchor: &quot;message-#{@message.id}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @messages = @conversation.messages.includes(:user, :quoted_expenses)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @other_user = @conversation.other_user(current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      @expenses = @other_user ? @other_user.expenses.order(spent_on: :desc).limit(20) : []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      render &quot;conversations/show&quot;, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def message_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="36">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    params.require(:message).permit(:body, quoted_expense_ids: [])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="993fc1a41700027a78c0f03967188444bc2d98e3">
=======
        <div class="source_table" id="2e7c9ae90d34b460113d61374780ad5cb5d8bf7f">
>>>>>>> main
  <div class="header">
    <h3>app/controllers/pages_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>39</b> relevant lines.
      <span class="green"><b>39</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class PagesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  include ActionView::Helpers::NumberHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby">  # Make sure only logged-in users can see the dashboard</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :authenticate_user!, only: [ :dashboard ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def home</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def dashboard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">    # 1. FOR THE FILTER DROPDOWN</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    @categories = Category.all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">    # 2. CREATE THE MASTER SCOPE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    all_expenses = Expense.for_user(current_user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">                            .includes(:category, :user, :group)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">    # --- FIX ---</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">    # 3. GET GROUP EXPENSES (This scope is NEVER filtered)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="19">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    group_expenses_query = all_expenses.where.not(group_id: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="20">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    @group_total = group_expenses_query.sum(:amount)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    @recent_group_expenses = group_expenses_query.order(spent_on: :desc).limit(5)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">    # 4. CREATE PERSONAL SCOPE (This scope *will* be filtered)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="24">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    personal_expenses_query = all_expenses.where(group_id: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby">                            </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    if params[:category_id].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="27">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      personal_expenses_query = personal_expenses_query.where(category_id: params[:category_id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="29">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    if params[:start_date].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="30">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      personal_expenses_query = personal_expenses_query.where(&quot;spent_on &gt;= ?&quot;, params[:start_date])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="32">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    if params[:end_date].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="33">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      personal_expenses_query = personal_expenses_query.where(&quot;spent_on &lt;= ?&quot;, params[:end_date])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby">    # 5. CALCULATE WIDGETS FROM THE (FILTERED) PERSONAL SCOPE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="37">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    @personal_total = personal_expenses_query.sum(:amount)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="38">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    @recent_personal_expenses = personal_expenses_query.order(spent_on: :desc).limit(5)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby">    # &quot;Top 5 Largest Personal Expenses&quot; widget should use the filtered personal query</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="41">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    @top_5_largest_personal_expenses = personal_expenses_query.order(amount: :desc).limit(5)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby">    # 6. GET DATA FOR CHARTS (FROM FILTERED PERSONAL SCOPE)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby">    # The charts will now *only* reflect personal, filtered data.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="45">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    @spending_over_time = personal_expenses_query.group_by_day(:spent_on,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            

            <code class="ruby">                                                      last: 30,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby">                                                      format: &quot;%b %d&quot;).sum(:amount)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="49">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    category_data = personal_expenses_query.joins(:category)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            

            <code class="ruby">                                  .group(&quot;categories.name&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            

            <code class="ruby">                                  .sum(:amount)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="53">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    @category_labels = category_data.keys</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="54">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    @category_data = category_data.values</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby">    # 7. GET AI SUMMARY</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="57">
            
              <span class="hits">17</span>
            

            

            <code class="ruby">    @ai_summary = get_ai_summary(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            

            <code class="ruby">      personal_total: @personal_total, # Filtered total</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            

            <code class="ruby">      group_total: @group_total,       # Unfiltered total</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            

            <code class="ruby">      category_data: category_data,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            

            <code class="ruby">      top_expenses: @top_5_largest_personal_expenses</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def get_ai_summary(personal_total:, group_total:, category_data:, top_expenses:)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            

            <code class="ruby">    # Check if we have a stubbed summary for testing</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="69">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    if PagesController.class_variable_defined?(:@@stubbed_ai_summary)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      return PagesController.class_variable_get(:@@stubbed_ai_summary)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="73">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    total_spending = personal_total + group_total</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            

            <code class="ruby">    # Don&#39;t bother calling the API if there&#39;s no data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="75">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    return &quot;Start logging expenses to get your AI summary!&quot; if total_spending == 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            

            <code class="ruby">    # 1. Format the data for the prompt</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="78">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    prompt_data = &quot;&quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            

            <code class="ruby">    Total Personal Spent: #{number_to_currency(personal_total)}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby">    Total Group Spent: #{number_to_currency(group_total)}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby">    Total Combined Spent: #{number_to_currency(total_spending)}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            

            <code class="ruby">    Spending by Category: #{category_data.to_json}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="83">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    5 Largest Expenses: #{top_expenses.map { |e| &quot;#{e.title} (#{number_to_currency(e.amount)})&quot; }.to_json}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            

            <code class="ruby">    &quot;&quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            

            <code class="ruby">    # 2. Create the prompt</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="87">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    prompt = &quot;&quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            

            <code class="ruby">    You are a friendly financial assistant. Based on the following spending data,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            

            <code class="ruby">    write a short, 2-3 sentence summary for the user. Give one positive insight</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            

            <code class="ruby">    and one helpful tip. Be encouraging and brief.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            

            <code class="ruby">    Data:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            

            <code class="ruby">    #{prompt_data}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            

            <code class="ruby">    Summary:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            

            <code class="ruby">    &quot;&quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            

            <code class="ruby">    # 3. Call the API</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="100">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      client = OpenAI::Client.new(access_token: ENV.fetch(&quot;OPENAI_API_KEY&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="101">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      response = client.chat(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            

            <code class="ruby">        parameters: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            

            <code class="ruby">          model: &quot;gpt-3.5-turbo&quot;, # Cheaper and faster</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            

            <code class="ruby">          messages: [ { role: &quot;user&quot;, content: prompt } ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            

            <code class="ruby">          temperature: 0.7,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            

            <code class="ruby">          max_tokens: 150</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="109">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      response.dig(&quot;choices&quot;, 0, &quot;message&quot;, &quot;content&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            

            <code class="ruby">    rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            

            <code class="ruby">      # If the API fails, log the error and show a nice message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="112">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      Rails.logger.error &quot;AI Summary Failed: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="113">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      &quot;Your AI summary is being generated. Check back soon!&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="dfebe98e1e225e6917b293a0bf61033dda5034ce">
  <div class="header">
    <h3>app/controllers/widget_summaries_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>11</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class WidgetSummariesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">  # The :empty action was being blocked by Devise, causing a 302 redirect.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby">  # We can safely exclude it from authentication, as it just renders</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby">  # an empty view to close the modal.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_action :authenticate_user!, except: [:empty]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  layout false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    @widget_type = params[:widget]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">    # 1. Get the same filtered data as the dashboard</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    dashboard_data = DashboardDataService.new(current_user, params).fetch_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">    # 2. Generate *only* the specific widget summary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    analyzer = DashboardAiAnalyzerService.new(dashboard_data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    @summary_html = analyzer.generate_widget_summary(@widget_type).html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">    # 3. Render the modal view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    render :show</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def empty</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    render :empty</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="392288d24cfede95fb97517a5520bbc854130a99">
=======
        <div class="source_table" id="d8db9d419c96ec9a8d22a0db7d65cdac80777d3e">
>>>>>>> main
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module ApplicationHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="aa28821daad526419e7aebaf3655987110cf6e57">
=======
        <div class="source_table" id="57235473b7cd6875fd52012c117529bdac86c511">
>>>>>>> main
  <div class="header">
    <h3>app/helpers/conversations_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module ConversationsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="9aa1748971c98ec8c5ed99b0eff92d87561ec243">
=======
        <div class="source_table" id="af573ed98042a5cbe05590cdc80307ec02d4d453">
>>>>>>> main
  <div class="header">
    <h3>app/helpers/expenses_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>14</b> relevant lines.
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module ExpensesHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def participant_summary(expense)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="3">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    participants = expense.participants.to_a</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="5">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    return &quot;Just you&quot; if participants.blank? || (participants.size == 1 &amp;&amp; participants.first.id == expense.user_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="7">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    per_person = calculate_per_person_share(expense, participants.count)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="8">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    names = participants.map { |user| display_user_name(user) }.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="9">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    &quot;#{per_person}: #{names}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def display_user_name(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="13">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    user.full_name.presence || user.email</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def calculate_per_person_share(expense, count)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="19">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    amount = expense.amount.to_f</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="20">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    return number_to_currency(amount) if count.zero?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="22">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    number_to_currency(amount / count)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="191a6fce8256beda2bfa38f3c4745aa43ed61f83">
=======
        <div class="source_table" id="7d0d770c90996975449f916871cf1d0e10e05f84">
>>>>>>> main
  <div class="header">
    <h3>app/helpers/messages_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module MessagesHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="a9575c90fb470617c2a07248cd8da1033aad190c">
=======
        <div class="source_table" id="41763dbe296e1055a87d0402d12e095103b8f48d">
>>>>>>> main
  <div class="header">
    <h3>app/helpers/pages_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module PagesHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="a275dc698299be5650b00b09b2e8521caa12fe54">
  <div class="header">
    <h3>app/helpers/widget_summaries_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module WidgetSummariesHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="996b2c75713f0647f71cb05e1fb23645a9b75eed">
=======
        <div class="source_table" id="924b86297b25c3b5a27201de54015e138e96b72a">
>>>>>>> main
  <div class="header">
    <h3>app/models/application_record.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class ApplicationRecord &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  primary_abstract_class</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="41d047064878ec398a0c071278ee6a594d08b771">
=======
        <div class="source_table" id="dd2060ae2bdbd97717cd543ff691f670fa19cf91">
>>>>>>> main
  <div class="header">
    <h3>app/models/category.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class Category &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :expenses, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :name, presence: true, uniqueness: true, length: { maximum: 50 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="103" data-linenumber="4">
            
              <span class="hits">103</span>
            

            

            <code class="ruby">  before_save { self.name = name.strip.titleize }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="45b0d42d380a2e1843b7d460b9e2c932953da6e6">
=======
        <div class="source_table" id="bfed032cef9bb3c6277409d1c038d5e325099558">
>>>>>>> main
  <div class="header">
    <h3>app/models/comment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class Comment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :expense</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :body, presence: true, length: { maximum: 500 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="fd21aed388ee081529df17dd6538359fcfc3644d">
=======
        <div class="source_table" id="8d3189a45901a4e931d8fbb7433d725a4a3d97a9">
>>>>>>> main
  <div class="header">
    <h3>app/models/conversation.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>29</b> relevant lines.
      <span class="green"><b>29</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class Conversation &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">  # Conversations are always between two users (user_a and user_b).</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :user_a, class_name: &quot;User&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :user_b, class_name: &quot;User&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :messages, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :user_a_id, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :user_b_id, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validate :different_users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  scope :between, -&gt;(user1, user2) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    a, b = order_pair(user1.id, user2.id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    where(user_a_id: a, user_b_id: b)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def self.find_or_create_between(user1, user2)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="18">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">    return nil if user1.blank? || user2.blank? || user1.id == user2.id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="19">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    a, b = order_pair(user1.id, user2.id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="20">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    conversation = find_by(user_a_id: a, user_b_id: b)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="21">
            
              <span class="hits">7</span>
            

            

            <code class="ruby">    return conversation if conversation.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="23">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">    create!(user_a_id: a, user_b_id: b)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def participants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    User.where(id: [ user_a_id, user_b_id ])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def other_user(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="31">
            
              <span class="hits">5</span>
            

            

            <code class="ruby">    return user_b if user.id == user_a_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="32">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    return user_a if user.id == user_b_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby">    nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def different_users</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="39">
            
              <span class="hits">20</span>
            

            

            <code class="ruby">    errors.add(:base, &quot;Conversation must be between two different users&quot;) if user_a_id == user_b_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def self.order_pair(id1, id2)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="43">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    ids = [ id1.to_i, id2.to_i ].sort</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="44">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    return ids[0], ids[1]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def order_pair(id1, id2)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    self.class.order_pair(id1, id2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="07a4f71dfd2a8211ef421c2d8313059c5f8fd305">
=======
        <div class="source_table" id="5b89a928b061964091ebe71b5be0d8ffb20bcc33">
>>>>>>> main
  <div class="header">
    <h3>app/models/expense.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>65</b> relevant lines.
      <span class="green"><b>65</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class Expense &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :category</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :group, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :comments, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :message_expenses, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :messages, through: :message_expenses</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :title, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :amount, numericality: { greater_than_or_equal_to: 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :spent_on, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validate  :participants_belong_to_group</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
<<<<<<< HEAD
=======
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_validation :normalize_participant_ids</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="16">
>>>>>>> main
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  scope :recent, -&gt; { order(spent_on: :desc) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  scope :for_user, lambda { |user_id|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="18">
            
              <span class="hits">25</span>
            

            

            <code class="ruby">    id = Array(user_id).first.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="19">
            
              <span class="hits">25</span>
            

            

            <code class="ruby">    table = arel_table</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="21">
            
              <span class="hits">25</span>
            

            

            <code class="ruby">    if sqlite_adapter?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="22">
            
              <span class="hits">24</span>
            

            

            <code class="ruby">      patterns = [ &quot;[#{id}]&quot;, &quot;[#{id},%&quot;, &quot;%,#{id},%&quot;, &quot;%,#{id}]&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="120" data-linenumber="23">
            
              <span class="hits">120</span>
            

            

            <code class="ruby">      participant_clause = patterns.map { |pattern| table[:participant_ids].matches(pattern) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="72" data-linenumber="24">
            
              <span class="hits">72</span>
            

            

            <code class="ruby">                                   .reduce { |memo, node| memo.or(node) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="25">
            
              <span class="hits">24</span>
            

            

            <code class="ruby">      participant_clause ||= table[:participant_ids].matches(&quot;[#{id}]&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="26">
            
              <span class="hits">24</span>
            

            

            <code class="ruby">      where(table[:user_id].eq(id)).or(where(participant_clause))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      where(table[:user_id].eq(id)).or(where(&quot;? = ANY(participant_ids)&quot;, id))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def participants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="33">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    return User.none if participant_ids.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="35">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">    User.where(id: participant_ids)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def participant_ids=(raw_ids)</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="192" data-linenumber="37">
=======
          <li class="covered" data-hits="172" data-linenumber="39">
>>>>>>> main
            
              <span class="hits">192</span>
            

            

            <code class="ruby">    cleaned = normalize_ids(raw_ids)</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="192" data-linenumber="38">
=======
          <li class="covered" data-hits="172" data-linenumber="40">
>>>>>>> main
            
              <span class="hits">192</span>
            

            

            <code class="ruby">    super(serialize_participant_ids(cleaned))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def participant_ids</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="296" data-linenumber="42">
=======
          <li class="covered" data-hits="266" data-linenumber="44">
>>>>>>> main
            
              <span class="hits">296</span>
            

            

            <code class="ruby">    normalize_ids(deserialize_participant_ids(super()))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def normalize_participant_ids</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="94" data-linenumber="48">
            
              <span class="hits">94</span>
            

            

            <code class="ruby">    ids = participant_ids</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="94" data-linenumber="49">
            
              <span class="hits">94</span>
            

            

            <code class="ruby">    ids = [ user_id ].compact if ids.blank? &amp;&amp; user_id.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="94" data-linenumber="50">
=======
          <li class="covered" data-hits="84" data-linenumber="50">
>>>>>>> main
            
              <span class="hits">94</span>
            

            

            <code class="ruby">    ids = participant_ids</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="84" data-linenumber="51">
            
              <span class="hits">84</span>
            

            

            <code class="ruby">    ids = [ user_id ].compact if ids.blank? &amp;&amp; user_id.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="84" data-linenumber="52">
            
              <span class="hits">84</span>
            

            

            <code class="ruby">    self.participant_ids = ids</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def participants_belong_to_group</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="94" data-linenumber="54">
=======
          <li class="covered" data-hits="84" data-linenumber="56">
>>>>>>> main
            
              <span class="hits">94</span>
            

            

            <code class="ruby">    ids = participant_ids</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="94" data-linenumber="55">
=======
          <li class="covered" data-hits="84" data-linenumber="57">
>>>>>>> main
            
              <span class="hits">94</span>
            

            

            <code class="ruby">    return if ids.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="92" data-linenumber="57">
=======
          <li class="covered" data-hits="82" data-linenumber="59">
>>>>>>> main
            
              <span class="hits">92</span>
            

            

            <code class="ruby">    if group.blank?</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="68" data-linenumber="58">
=======
          <li class="covered" data-hits="62" data-linenumber="60">
>>>>>>> main
            
              <span class="hits">68</span>
            

            

            <code class="ruby">      extra_ids = ids - [ user_id ]</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="68" data-linenumber="59">
=======
          <li class="covered" data-hits="62" data-linenumber="61">
>>>>>>> main
            
              <span class="hits">68</span>
            

            

            <code class="ruby">      errors.add(:participant_ids, &quot;can only include yourself for personal expenses&quot;) if extra_ids.any?</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="68" data-linenumber="60">
=======
          <li class="covered" data-hits="62" data-linenumber="62">
>>>>>>> main
            
              <span class="hits">68</span>
            

            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="24" data-linenumber="63">
            
              <span class="hits">24</span>
            

            

            <code class="ruby">    group_member_ids = group.group_memberships.pluck(:user_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="64">
            
              <span class="hits">24</span>
            

            

            <code class="ruby">    invalid = ids - group_member_ids</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="65">
=======
          <li class="covered" data-hits="20" data-linenumber="65">
>>>>>>> main
            
              <span class="hits">24</span>
            

            

            <code class="ruby">    group_member_ids = group.group_memberships.pluck(:user_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="66">
            
              <span class="hits">20</span>
            

            

            <code class="ruby">    invalid = ids - group_member_ids</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="67">
            
              <span class="hits">20</span>
            

            

            <code class="ruby">    errors.add(:participant_ids, &quot;must be members of the group&quot;) if invalid.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def normalize_ids(values)</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="489" data-linenumber="69">
=======
          <li class="covered" data-hits="439" data-linenumber="71">
>>>>>>> main
            
              <span class="hits">489</span>
            

            

            <code class="ruby">    Array(values).flatten.filter_map do |value|</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="389" data-linenumber="70">
=======
          <li class="covered" data-hits="349" data-linenumber="72">
>>>>>>> main
            
              <span class="hits">389</span>
            

            

            <code class="ruby">      str = value.to_s.strip</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="389" data-linenumber="71">
=======
          <li class="covered" data-hits="349" data-linenumber="73">
>>>>>>> main
            
              <span class="hits">389</span>
            

            

            <code class="ruby">      next if str.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="388" data-linenumber="73">
=======
          <li class="covered" data-hits="348" data-linenumber="75">
>>>>>>> main
            
              <span class="hits">388</span>
            

            

            <code class="ruby">      Integer(str, 10)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            

            <code class="ruby">    rescue ArgumentError</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="77">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            

            <code class="ruby">    end.uniq</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def deserialize_participant_ids(raw)</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="300" data-linenumber="80">
=======
          <li class="covered" data-hits="270" data-linenumber="82">
>>>>>>> main
            
              <span class="hits">300</span>
            

            

            <code class="ruby">    case raw</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            

            <code class="ruby">    when String</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="297" data-linenumber="82">
=======
          <li class="covered" data-hits="267" data-linenumber="84">
>>>>>>> main
            
              <span class="hits">297</span>
            

            

            <code class="ruby">      raw.present? ? JSON.parse(raw) : []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            

            <code class="ruby">    when Array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="86">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      raw</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            

            <code class="ruby">    when nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="88">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="90">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      Array(raw)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            

            <code class="ruby">  rescue JSON::ParserError</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="93">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def serialize_participant_ids(ids)</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="192" data-linenumber="95">
=======
          <li class="covered" data-hits="172" data-linenumber="97">
>>>>>>> main
            
              <span class="hits">192</span>
            

            

            <code class="ruby">    sqlite_adapter? ? ids.to_json : ids</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="100">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def sqlite_adapter?</code>
          </li>
        </div>
      
        <div>
<<<<<<< HEAD
          <li class="covered" data-hits="192" data-linenumber="99">
=======
          <li class="covered" data-hits="172" data-linenumber="101">
>>>>>>> main
            
              <span class="hits">192</span>
            

            

            <code class="ruby">    ActiveRecord::Base.connection.adapter_name.downcase.include?(&quot;sqlite&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def self.sqlite_adapter?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="105">
            
              <span class="hits">24</span>
            

            

            <code class="ruby">    ActiveRecord::Base.connection.adapter_name.downcase.include?(&quot;sqlite&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="fbb6f6d593e4932b3526b0d6c7accc8d46778e5c">
=======
        <div class="source_table" id="2f34ae36b28c09afa7db6504a2a7610a2a0f9d0f">
>>>>>>> main
  <div class="header">
    <h3>app/models/group.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>13</b> relevant lines.
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class Group &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :group_memberships, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :users, through: :group_memberships</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :expenses, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">  # Future: has_many :expenses, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  before_create :generate_join_code</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :name, presence: { message: &quot;Group name can&#39;t be blank&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :join_code, uniqueness: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def add_member(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="14">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">    return if users.include?(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="15">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">    users &lt;&lt; user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def generate_join_code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="21">
            
              <span class="hits">61</span>
            

            

            <code class="ruby">    self.join_code ||= SecureRandom.hex(4).upcase  # Example: A9F3C1D2</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="1e01f0d38b3c300df0e1e7d7cb78a8e7296e1f6e">
=======
        <div class="source_table" id="1d5c5c9153350c358036fbcafa3ba2777919ec69">
>>>>>>> main
  <div class="header">
    <h3>app/models/group_membership.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class GroupMembership &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :group</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :user_id, uniqueness: { scope: :group_id, message: &quot;is already in this group&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="2624ceffe4a43ff8d315139143b8af6b089de889">
=======
        <div class="source_table" id="df9ead13c7d1c32f655164ce5d6af93a8fee6346">
>>>>>>> main
  <div class="header">
    <h3>app/models/message.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>7</b> relevant lines.
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class Message &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :conversation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :message_expenses, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :quoted_expenses, through: :message_expenses, source: :expense</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  validates :body, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="10">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">  scope :recent, -&gt; { order(created_at: :asc) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="1c434006e4819535eca7e131a9ef9da95a44f538">
=======
        <div class="source_table" id="f7af3d0d0ba44bcc9628c1c058ad55f41380e8e8">
  <div class="header">
    <h3>app/models/message_expense.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>3</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class MessageExpense &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  belongs_to :expense</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="eb48e1ae0e40e0a2ceedf36cb40e4d9b3e058226">
>>>>>>> main
  <div class="header">
    <h3>app/models/user.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>13</b> relevant lines.
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class User &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby">  # Include default devise modules. Others available are:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            

            <code class="ruby">  # :confirmable, :lockable, :timeoutable, :trackable and :omniauthable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  devise :database_authenticatable, :registerable,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby">         :recoverable, :rememberable, :validatable,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">         :omniauthable, omniauth_providers: [ :google_oauth2 ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def self.from_omniauth(auth)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            

            <code class="ruby">    # Try to find user by provider &amp; uid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="9">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    user = where(provider: auth.provider, uid: auth.uid).first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">    # If not found, try by email</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="11">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    user ||= find_by(email: auth.info.email)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">    # If still not found, create new user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="13">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    if user.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="14">
            
              <span class="hits">6</span>
            

            

            <code class="ruby">      user = create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">        email: auth.info.email,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby">        full_name: auth.info.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">        avatar_url: auth.info.image,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">        provider: auth.provider,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">        uid: auth.uid,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">        password: Devise.friendly_token[0, 20]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">      # Update missing OAuth info if needed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="24">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      user.update(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby">        provider: auth.provider,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">        uid: auth.uid,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby">        full_name: user.full_name.presence || auth.info.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">        avatar_url: user.avatar_url.presence || auth.info.image</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="31">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">    user.reload</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :group_memberships, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :groups, through: :group_memberships</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :expenses, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  has_many :comments, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
<<<<<<< HEAD
        <div class="source_table" id="3e0456f6c40cb8fbd9b72480746f4a4e4098a914">
  <div class="header">
    <h3>app/services/dashboard_ai_analyzer_service.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>34</b> relevant lines.
      <span class="green"><b>34</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            

            <code class="ruby"># app/services/dashboard_ai_analyzer_service.rb</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class DashboardAiAnalyzerService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def initialize(dashboard_data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="4">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      @data = dashboard_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby">    # 1. FOR THE MAIN DASHBOARD SUMMARY</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def generate_main_summary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="9">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      prompt = &lt;&lt;~PROMPT</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">        You are a financial analyst. Based on the following data, provide a concise summary (2-3 sentences)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">        of the user&#39;s spending habits.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">        - Total Personal Spending: #{@data.personal_total}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            

            <code class="ruby">        - Total Group Spending: #{@data.group_total}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            

            <code class="ruby">        - Top Category: #{@data.category_data.labels.first} ($#{@data.category_data.data.first})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            

            <code class="ruby">        - Number of Categories: #{@data.category_data.labels.count}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="17">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">        - Top 5 Expenses: #{@data.top_5_largest_personal_expenses.map { |e| &quot;#{e.title} ($#{e.amount})&quot; }.join(&#39;, &#39;)}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby">        - Spending Trend: (Analyze the spending_over_time hash: #{@data.spending_over_time})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">        Your summary:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">      PROMPT</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">      # Call your AI service (e.g., OpenAI)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">      # OpenAiClient.new.complete(prompt)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="25">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      &quot;This is a placeholder for the main AI summary. You spent $#{@data.personal_total} personally, with most of it going to #{@data.category_data.labels.first}.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">    # 2. FOR THE WIDGET POPUPS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def generate_widget_summary(widget_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="30">
            
              <span class="hits">9</span>
            

            

            <code class="ruby">      case widget_type.to_sym</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby">      when :personal_expenses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="32">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">        generate_personal_summary</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            

            <code class="ruby">      when :group_expenses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        generate_group_summary</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby">      when :top_5_expenses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        generate_top_5_summary</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby">      when :spending_over_time</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        generate_bar_chart_summary</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby">      when :category_spending</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="40">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">        generate_pie_chart_summary</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">        &quot;No analysis available.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def generate_personal_summary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="49">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      prompt = &lt;&lt;~PROMPT</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            

            <code class="ruby">        Analyze this personal expense data. Total spent is $#{@data.personal_total}.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            

            <code class="ruby">        Recent expenses are: #{@data.recent_personal_expenses.map(&amp;:title).join(&#39;, &#39;)}.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby">        Provide a deep insight as one paragraph. Don&#39;t just list the data. </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            

            <code class="ruby">        What do these recent expenses suggest about current habits? </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby">        How does the total relate to a typical budget?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby">      PROMPT</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            

            <code class="ruby">      # OpenAiClient.new.complete(prompt)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="58">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      &quot;&lt;p&gt;Your personal spending of &lt;strong&gt;$#{@data.personal_total}&lt;/strong&gt; seems focused on daily activities, given recent purchases like &#39;#{@data.recent_personal_expenses.first&amp;.title}&#39;.&lt;/p&gt;&lt;p&gt;It&#39;s important to notice if these small, frequent purchases are adding up more than you realize. This category often represents the core of your discretionary budget.&lt;/p&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def generate_group_summary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      prompt = &lt;&lt;~PROMPT</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            

            <code class="ruby">        Analyze this group expense data. Total spent is $#{@data.group_total}.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby">        Compare this to the personal total of $#{@data.personal_total}.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            

            <code class="ruby">        Provide a deep insight as one paragraph.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            

            <code class="ruby">        What does this comparison reveal about social vs. personal spending?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            

            <code class="ruby">      PROMPT</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            

            <code class="ruby">      # OpenAiClient.new.complete(prompt)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      &quot;&lt;p&gt;You&#39;ve spent &lt;strong&gt;$#{@data.group_total}&lt;/strong&gt; in group settings. This type of spending is often social and can be unpredictable.&lt;/p&gt;&lt;p&gt;It&#39;s useful to compare this to your &lt;strong&gt;$#{@data.personal_total}&lt;/strong&gt; personal total to see if your social spending is in line with your personal financial goals.&lt;/p&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="73">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def generate_top_5_summary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      top_expense = @data.top_5_largest_personal_expenses.first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      prompt = &lt;&lt;~PROMPT</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            

            <code class="ruby">        Analyze these top 5 expenses, led by &#39;#{top_expense&amp;.title}&#39; ($#{top_expense&amp;.amount}).</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            

            <code class="ruby">        Provide a deep insight as one paragraph.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            

            <code class="ruby">        What is the impact of these &#39;one-off&#39; purchases on the overall budget?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            

            <code class="ruby">      PROMPT</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby">      # OpenAiClient.new.complete(prompt)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      &quot;&lt;p&gt;Your top 5 expenses are driving a significant portion of your spending, led by &lt;strong&gt;&#39;#{top_expense&amp;.title}&#39; ($#{top_expense&amp;.amount})&lt;/strong&gt;.&lt;/p&gt;&lt;p&gt;These &#39;one-off&#39; large purchases can often derail a budget. Were these planned for? Reducing the frequency of just these few items can have a greater impact than cutting dozens of small purchases.&lt;/p&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="85">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def generate_bar_chart_summary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="86">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      prompt = &lt;&lt;~PROMPT</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            

            <code class="ruby">        Analyze the spending over time data: #{@data.spending_over_time}.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            

            <code class="ruby">        Provide a deep insight as one paragraph.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            

            <code class="ruby">        What do the peaks and valleys suggest? What should the user look for?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            

            <code class="ruby">      PROMPT</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            

            <code class="ruby">      # OpenAiClient.new.complete(prompt)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="93">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      &quot;&lt;p&gt;Your spending over the last 30 days shows clear peaks and valleys.&lt;/p&gt;&lt;p&gt;Look closer at the dates with high spendingdo they correspond to paydays, weekends, or specific events? Understanding this &lt;strong&gt;timing&lt;/strong&gt; is key to managing cash flow and avoiding spending spikes.&lt;/p&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def generate_pie_chart_summary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="97">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      top_cat = @data.category_data.labels.first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="98">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      top_val = @data.category_data.data.first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="99">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      prompt = &lt;&lt;~PROMPT</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            

            <code class="ruby">        Analyze this category spending data. Top category is &#39;#{top_cat}&#39; at $#{top_val}.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            

            <code class="ruby">        There are #{@data.category_data.labels.count} categories total.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            

            <code class="ruby">        Provide a deep insight as one paragraph.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            

            <code class="ruby">        What is the &quot;long tail&quot; effect and why is it important here?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            

            <code class="ruby">      PROMPT</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            

            <code class="ruby">      # OpenAiClient.new.complete(prompt)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="107">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">      &quot;&lt;p&gt;Your spending is heavily weighted towards &lt;strong&gt;&#39;#{top_cat}&#39;&lt;/strong&gt;, which accounts for &lt;strong&gt;$#{top_val}&lt;/strong&gt;.&lt;/p&gt;&lt;p&gt;While this is your largest category, don&#39;t ignore the &#39;long tail&#39; of smaller categories. Often, 5-6 small categories combined (like &#39;Subscriptions&#39;, &#39;Coffee&#39;, etc.) can add up to be your second or third largest expense area, yet fly under the radar.&lt;/p&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="75a095242756d69fd460c0c249dbfd0fdaf1aee8">
  <div class="header">
    <h3>app/services/dashboard_data_service.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>30</b> relevant lines.
      <span class="green"><b>30</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;ostruct&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">class DashboardDataService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  attr_reader :user, :params, :expenses</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def initialize(user, params = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="7">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    @user = user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="8">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    @params = params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            

            <code class="ruby">    # @expenses is the master filtered scope</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="10">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    @expenses = fetch_filtered_expenses</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            

            <code class="ruby">  # This method returns a simple struct holding all our data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def fetch_data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="15">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    personal_expenses = @expenses.where(group_id: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="16">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    group_expenses = @expenses.where.not(group_id: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="18">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    OpenStruct.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            

            <code class="ruby">      categories: Category.all,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            

            <code class="ruby">      personal_total: personal_expenses.sum(:amount),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby">      group_total: group_expenses.sum(:amount),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            

            <code class="ruby">      recent_personal_expenses: personal_expenses.order(spent_on: :desc).limit(5),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            

            <code class="ruby">      recent_group_expenses: group_expenses.order(spent_on: :desc).limit(5),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            

            <code class="ruby">      # Use the master @expenses scope for a combined top 5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            

            <code class="ruby">      top_5_largest_personal_expenses: @expenses.order(amount: :desc).limit(5),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            

            <code class="ruby">      spending_over_time: calculate_spending_over_time(@expenses), # Use master scope</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            

            <code class="ruby">      category_data: calculate_category_data(@expenses) # Use master scope</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def fetch_filtered_expenses</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby">    # This is correct: it gets all expenses for the user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="37">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    scope = user.expenses.includes(:category, :group)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="39">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    if params[:category_id].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      scope = scope.where(category_id: params[:category_id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="43">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    if params[:start_date].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      scope = scope.where(&quot;spent_on &gt;= ?&quot;, params[:start_date])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="47">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    if params[:end_date].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">      scope = scope.where(&quot;spent_on &lt;= ?&quot;, params[:end_date])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="51">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    scope</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def calculate_spending_over_time(filtered_scope)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            

            <code class="ruby">    # Default to last 30 days if no filters are set</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="56">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    start_date = params[:start_date].present? ? Date.parse(params[:start_date]) : 30.days.ago.to_date</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="57">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    end_date = params[:end_date].present? ? Date.parse(params[:end_date]) : Date.today</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            

            <code class="ruby">    # Get data and group by day</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="60">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    daily_data = filtered_scope.where(spent_on: start_date..end_date)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            

            <code class="ruby">                                  .group_by_day(:spent_on)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            

            <code class="ruby">                                  .sum(:amount)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby">    # Fill in missing days with 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="65">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    (start_date..end_date).each_with_object({}) do |day, hash|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="66">
            
              <span class="hits">97</span>
            

            

            <code class="ruby">      hash[day.strftime(&quot;%Y-%m-%d&quot;)] = daily_data[day] || 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  def calculate_category_data(filtered_scope)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            

            <code class="ruby">    # --- FIX ---</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            

            <code class="ruby">    # Change `joins` to `left_outer_joins` to include expenses</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            

            <code class="ruby">    # that might have `category_id: nil`.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="74">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    category_summary = filtered_scope.left_outer_joins(:category)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            

            <code class="ruby">                                      .group(&quot;categories.name&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            

            <code class="ruby">                                      .sum(:amount)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            

            <code class="ruby">    # Separate labels and data for the chart</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="80">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">    OpenStruct.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            

            <code class="ruby">      labels: category_summary.keys,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            

            <code class="ruby">      data: category_summary.values</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2942d803fdf142d462860d22b2c8adb1c385a76b">
=======
        <div class="source_table" id="0a93c323d0a5da52e6b70bff5adb8a2622325228">
>>>>>>> main
  <div class="header">
    <h3>app/services/imports/expenses_import.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>33</b> relevant lines.
      <span class="green"><b>33</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">require &quot;roo&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">module Imports</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">  class ExpensesImport</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    Result = Struct.new(:created, :skipped, keyword_init: true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    class ImportError &lt; StandardError; end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def self.call(file:, user:)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="9">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      new(file, user).call</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def initialize(file, user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="13">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">      @file = file</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="14">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">      @user = user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="15">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">      @created = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="16">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">      @skipped = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def call</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="20">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      raise ImportError, &quot;User must be provided.&quot; if @user.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="22">
            
              <span class="hits">8</span>
            

            

            <code class="ruby">      spreadsheet = open_spreadsheet(@file)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="23">
            
              <span class="hits">18</span>
            

            

            <code class="ruby">      header = spreadsheet.row(1).map { |h| h.to_s.strip.downcase }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="24">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      required = %w[title amount spent_on category]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="25">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      missing = required - header</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="26">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      raise ImportError, &quot;Missing columns: #{missing.join(&#39;, &#39;)}&quot; if missing.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="28">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      (2..spreadsheet.last_row).each do |i|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="29">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">        row = Hash[[ header, spreadsheet.row(i) ].transpose]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="30">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">        next if row.values.all?(&amp;:blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            

            <code class="ruby">        begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="33">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          category = Category.find_or_create_by!(name: row[&quot;category&quot;].to_s.strip)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="34">
            
              <span class="hits">2</span>
            

            

            <code class="ruby">          Expense.create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            

            <code class="ruby">            title: row[&quot;title&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            

            <code class="ruby">            amount: BigDecimal(row[&quot;amount&quot;].to_s),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            

            <code class="ruby">            spent_on: Date.parse(row[&quot;spent_on&quot;].to_s),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            

            <code class="ruby">            notes: row[&quot;notes&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            

            <code class="ruby">            category: category,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            

            <code class="ruby">            user: @user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            

            <code class="ruby">          )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">          @created += 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            

            <code class="ruby">        rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">          @skipped += 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">          Rails.logger.warn(&quot;Row #{i} skipped: #{e.message}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="48">
            
              <span class="hits">3</span>
            

            

            <code class="ruby">      Result.new(created: @created, skipped: @skipped)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            
              <span class="hits">1</span>
            

            

            <code class="ruby">    def open_spreadsheet(file)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="54">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">      ext  = File.extname(file&amp;.original_filename.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="55">
            
              <span class="hits">10</span>
            

            

            <code class="ruby">      path = file&amp;.tempfile&amp;.path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="skipped" data-hits="" data-linenumber="57">
            
              <span class="hits">skipped</span>
            

            

            <code class="ruby">      # :nocov: Defensive guard clauses (not part of normal flow)</code>
          </li>
        </div>
      
        <div>
          <li class="skipped" data-hits="10" data-linenumber="58">
            
              <span class="hits">skipped</span>
            

            

            <code class="ruby">      raise ImportError, &quot;No file provided.&quot; if file.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="skipped" data-hits="8" data-linenumber="59">
            
              <span class="hits">skipped</span>
            

            

            <code class="ruby">      raise ImportError, &quot;Unsupported file type.&quot; unless %w[.csv .xlsx].include?(ext)</code>
          </li>
        </div>
      
        <div>
          <li class="skipped" data-hits="" data-linenumber="60">
            
              <span class="hits">skipped</span>
            

            

            <code class="ruby">      # :nocov:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="62">
            
              <span class="hits">4</span>
            

            

            <code class="ruby">      ext == &quot;.xlsx&quot; ? Roo::Excelx.new(path) : Roo::CSV.new(path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
